{"path":"/stryker/src/isolated-runner/IsolatedTestRunnerAdapterWorker.js","content":"\"use strict\";\r\nvar Message_1 = require('./Message');\r\nvar test_runner_1 = require('stryker-api/test_runner');\r\nvar PluginLoader_1 = require('../PluginLoader');\r\nvar log4js = require('log4js');\r\nvar objectUtils_1 = require('../utils/objectUtils');\r\nvar log = log4js.getLogger('TestRunnerChildProcessAdapterWorker');\r\nvar TestRunnerChildProcessAdapterWorker = (function () {\r\n    function TestRunnerChildProcessAdapterWorker() {\r\n        this.listenToMessages();\r\n    }\r\n    TestRunnerChildProcessAdapterWorker.prototype.listenToMessages = function () {\r\n        var _this = this;\r\n        process.on('message', function (message) {\r\n            switch (message.type) {\r\n                case Message_1.MessageType.Start:\r\n                    _this.start(message.body);\r\n                    break;\r\n                case Message_1.MessageType.Run:\r\n                    _this.run(message.body);\r\n                    break;\r\n                case Message_1.MessageType.Init:\r\n                    _this.init();\r\n                    break;\r\n                case Message_1.MessageType.Dispose:\r\n                    _this.dispose();\r\n                    break;\r\n                default:\r\n                    log.warn('Received unsupported message: {}', JSON.stringify(message));\r\n            }\r\n        });\r\n    };\r\n    TestRunnerChildProcessAdapterWorker.prototype.start = function (body) {\r\n        this.loadPlugins(body.runnerOptions.strykerOptions.plugins);\r\n        this.underlyingTestRunner = test_runner_1.TestRunnerFactory.instance().create(body.runnerName, body.runnerOptions);\r\n    };\r\n    TestRunnerChildProcessAdapterWorker.prototype.init = function () {\r\n        var initPromise = void 0;\r\n        if (this.underlyingTestRunner.init) {\r\n            initPromise = this.underlyingTestRunner.init();\r\n        }\r\n        if (objectUtils_1.isPromise(initPromise)) {\r\n            initPromise.then(this.sendInitDone);\r\n        }\r\n        else {\r\n            this.sendInitDone();\r\n        }\r\n    };\r\n    TestRunnerChildProcessAdapterWorker.prototype.sendInitDone = function () {\r\n        process.send({ type: Message_1.MessageType.InitDone });\r\n    };\r\n    TestRunnerChildProcessAdapterWorker.prototype.dispose = function () {\r\n        var disposePromise = void 0;\r\n        if (this.underlyingTestRunner.dispose) {\r\n            disposePromise = this.underlyingTestRunner.dispose();\r\n        }\r\n        if (objectUtils_1.isPromise(disposePromise)) {\r\n            disposePromise.then(this.sendDisposeDone);\r\n        }\r\n        else {\r\n            this.sendDisposeDone();\r\n        }\r\n    };\r\n    TestRunnerChildProcessAdapterWorker.prototype.sendDisposeDone = function () {\r\n        process.send({ type: Message_1.MessageType.DisposeDone });\r\n    };\r\n    TestRunnerChildProcessAdapterWorker.prototype.run = function (body) {\r\n        this.underlyingTestRunner.run(body.runOptions).then(this.reportResult, this.reportErrorResult);\r\n    };\r\n    TestRunnerChildProcessAdapterWorker.prototype.loadPlugins = function (plugins) {\r\n        new PluginLoader_1.default(plugins).load();\r\n    };\r\n    TestRunnerChildProcessAdapterWorker.prototype.reportResult = function (result) {\r\n        var message = {\r\n            type: Message_1.MessageType.Result,\r\n            body: { result: result }\r\n        };\r\n        process.send(message);\r\n    };\r\n    TestRunnerChildProcessAdapterWorker.prototype.reportErrorResult = function (error) {\r\n        var message = {\r\n            type: Message_1.MessageType.Result,\r\n            body: {\r\n                result: {\r\n                    testNames: [],\r\n                    result: test_runner_1.TestResult.Error,\r\n                }\r\n            }\r\n        };\r\n        process.send(message);\r\n    };\r\n    return TestRunnerChildProcessAdapterWorker;\r\n}());\r\nnew TestRunnerChildProcessAdapterWorker();\r\n//# sourceMappingURL=IsolatedTestRunnerAdapterWorker.js.map"}
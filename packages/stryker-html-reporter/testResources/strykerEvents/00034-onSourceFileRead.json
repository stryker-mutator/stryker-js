{"path":"/stryker/src/utils/StrykerTempFolder.js","content":"\"use strict\";\r\nvar fs = require('fs');\r\nvar path = require('path');\r\nvar mkdirp = require('mkdirp');\r\nvar fileUtils = require('./fileUtils');\r\nvar log4js = require('log4js');\r\nvar log = log4js.getLogger('fileUtils');\r\nvar baseTempFolder = path.join(process.cwd(), '.stryker-tmp');\r\nvar tempFolder = path.join(baseTempFolder, random().toString());\r\nensureFolderExists(baseTempFolder);\r\nensureFolderExists(tempFolder);\r\nfunction createRandomFolder(prefix) {\r\n    return ensureFolderExists(tempFolder + path.sep + prefix + random());\r\n}\r\nfunction random() {\r\n    return Math.ceil(Math.random() * 10000000);\r\n}\r\nfunction ensureFolderExists(path) {\r\n    if (!fileOrFolderExists(path)) {\r\n        mkdirp.sync(path);\r\n    }\r\n    return path;\r\n}\r\nfunction fileOrFolderExists(path) {\r\n    try {\r\n        var stats = fs.lstatSync(path);\r\n        return true;\r\n    }\r\n    catch (error) {\r\n        return false;\r\n    }\r\n}\r\nfunction writeFile(filename, data) {\r\n    return new Promise(function (resolve, reject) {\r\n        fs.writeFile(filename, data, { encoding: 'utf8' }, function (error) {\r\n            if (error) {\r\n                reject(error);\r\n            }\r\n            else {\r\n                resolve();\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction copyFile(fromFilename, toFilename) {\r\n    return new Promise(function (resolve, reject) {\r\n        var readStream = fs.createReadStream(fromFilename, { encoding: 'utf8' });\r\n        var writeStream = fs.createWriteStream(toFilename, { encoding: 'utf8' });\r\n        readStream.on('error', reject);\r\n        writeStream.on('error', reject);\r\n        readStream.pipe(writeStream);\r\n        readStream.on('end', function () { return resolve(); });\r\n    });\r\n}\r\nfunction clean() {\r\n    log.info(\"Cleaning stryker temp folder \" + baseTempFolder);\r\n    return fileUtils.deleteDir(baseTempFolder);\r\n}\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = {\r\n    createRandomFolder: createRandomFolder,\r\n    writeFile: writeFile,\r\n    copyFile: copyFile,\r\n    ensureFolderExists: ensureFolderExists,\r\n    clean: clean\r\n};\r\n//# sourceMappingURL=StrykerTempFolder.js.map"}